<template>
	<div>
		<div class="panel-bg">			
			<div class="weui_panel_bd">
		      <div class="media_box" >
		        <div class="media_hd" v-if="imgList.img">
		          <img class="media_appmsg_thumb" :src="imgList.img" alt="">
		        </div>
		        <div class="media_bd">
		          <div class="product_desc">{{product.title}}</div>
		          <div class="product_price">售价：{{price}}</div>
		          <div class="clearfix">
			        <x-number :min=1 :max=10 :value="count" :fillable=true @on-change="chooseNumber"></x-number>
			      </div>
		        </div>
		      </div>
			</div>
		</div>
		<div class="panel-bg mt-10">
			<group>
		      <cell title="配送信息：请添加" is-link></cell>
		    </group>
		</div>
		<div class="panel-bg mt-10">
			<group>
		      <cell title="配送信息：" :inline-desc="addressName" is-link></cell>
		    </group>
		</div>
		<div class="panel-bg mt-10">
			<div class="m-lr-15">留言</div>
			<x-textarea :max="200" placeholder="请填写详细信息"></x-textarea>
		</div>
		<sticky class="ui-box" direction="bottom">
        <div class="ui-price">
          <span>共{{count}}件 总计：</span><strong class="total-price">{{totalPrice}}</strong><span>元</span>
        </div>
        <div class="ui-btn">
          <x-button type="primary" class="no-border-radius" @click="goPay">去结算</x-button>
        </div>
      </sticky>
	</div>
</template>
<style scoped>
	.product_desc{
		font-size: 14px;
		line-height: 19px;
		color: #333333;
	}
	.product_price{
		font-size: 12px;
		margin-top: 5px;
		margin-bottom: 10px;
		color: #b2b2b2;
	}
	.media_bd{
		/*height: 100px;*/
		-webkit-box-flex: 1;
    	box-flex: 1;
	}
	.media_hd{
		width: 100px;
		height: 100px;
		margin-right: 15px;
		line-height: 100px;
    	text-align: center;
	}
	.media_box{
		    display: box;
		    display: -webkit-box;
		    box-align: center;
		    -webkit-box-align: center;
		    box-pack: center;
		    -webkit-box-pack: center;
		padding: 10px 15px;
		position: relative;
	}
	.media_appmsg_thumb{
		width: 100%;
	    height: 100%;
	    vertical-align: middle;
	}
	.weui_textarea{
		background-color: #f7f7f7;
	}
</style>
<script>
	import {XButton, Sticky, XNumber, Cell, Group, XTextarea} from '../components/'
	import {chooseNumber, getMyAddress} from '../vuex/actions'
	export default{
		components:{
			XButton, 
			Sticky, 
			XNumber,
			Cell, 
			Group,
			XTextarea
		},
		ready(){
			this.getMyAddress()
		},
		vuex:{
			getters: {
		      product: ({product}) => product.product,
		      count: ({ product }) => product.count,
		      price: ({product})   => product.product.types.find(type=>type.typeId===product.checkedType).price,
		      checkedType:({product}) => product.checkedType,
		      address:({address})  => address.address
		    },
		    actions: {
		      getMyAddress,
		      chooseNumber,
		    }
		},		
		computed:{
			totalPrice:function(){
	          return this.count * this.price
	        },
	        imgList:function(){
	          let index = this.checkedType;	     
	          console.log(this.address)     
	          return this.product.types.find(type=>type.typeId===index).imgs[0]
	        },
	        addressName:function(){
	        	return '<p>'+this.address.name +this.address.phone+'</p><p>'+this.address.address1+this.address.address2+'</p>'
	        }
		},
		methods:{			
		    goPay:function(){
		    	this.$route.router.go('/views/product-detail')
		    }		     
		}
	}
</script>